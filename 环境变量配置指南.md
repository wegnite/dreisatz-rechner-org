# Dreisatz Rechner 环境变量配置指南

## 🚀 快速配置关键功能

### 1. AI 图像生成服务 (高优先级)

#### 🔥 立即可用的免费服务

**Google AI Studio** (推荐首选)
- 访问: https://aistudio.google.com/
- 注册免费账户，获取API密钥
- 免费额度: 每月15个请求/分钟
- 配置: `GOOGLE_GENERATIVE_AI_API_KEY`

**DeepSeek** (推荐)
- 访问: https://platform.deepseek.com/
- 注册免费账户
- 免费额度: 较为慷慨
- 配置: `DEEPSEEK_API_KEY`

**Replicate** (重要)
- 访问: https://replicate.com/
- 注册免费账户
- 免费额度: $10 试用金
- 支持多种FLUX模型
- 配置: `REPLICATE_API_TOKEN`

**Fal.ai**
- 访问: https://fal.ai/
- 注册免费账户
- 配置: `FAL_API_KEY`

**Fireworks AI**
- 访问: https://fireworks.ai/
- 注册免费账户
- 配置: `FIREWORKS_API_KEY`

**OpenRouter** (聚合服务)
- 访问: https://openrouter.ai/
- 聚合多个AI服务
- 配置: `OPENROUTER_API_KEY`

### 2. Stripe 积分包配置 (收入相关)

#### 创建积分包产品步骤:

1. **登录Stripe控制台**: https://dashboard.stripe.com/
2. **创建产品**:
   - 产品 → 添加产品
   - 选择"一次性支付"类型

3. **建议的积分包配置**:

```
基础包 (Basic)
- 名称: 100 积分包
- 价格: $9.90 USD
- 描述: 100个AI生成积分，30天有效期

标准包 (Standard) 
- 名称: 200 积分包  
- 价格: $14.90 USD
- 描述: 200个AI生成积分，30天有效期

高级包 (Premium)
- 名称: 500 积分包
- 价格: $39.90 USD  
- 描述: 500个AI生成积分，30天有效期

企业包 (Enterprise)
- 名称: 1000 积分包
- 价格: $69.90 USD
- 描述: 1000个AI生成积分，30天有效期
```

4. **获取价格ID**: 创建后复制价格ID (格式: price_xxxxx)
5. **更新环境变量**:
```bash
NEXT_PUBLIC_STRIPE_PRICE_CREDITS_BASIC="price_xxxxx"
NEXT_PUBLIC_STRIPE_PRICE_CREDITS_STANDARD="price_xxxxx"  
NEXT_PUBLIC_STRIPE_PRICE_CREDITS_PREMIUM="price_xxxxx"
NEXT_PUBLIC_STRIPE_PRICE_CREDITS_ENTERPRISE="price_xxxxx"
```

### 3. 邮件服务配置 (用户体验)

#### Resend 邮件服务

1. **注册账户**: https://resend.com/
2. **验证发送域名**: 
   - 域名: `dreisatzrechner.org`
   - 添加DNS记录验证域名所有权
3. **获取API密钥**: API Keys → Create API Key
4. **创建Audience**: Audiences → Create Audience (用于Newsletter)
5. **配置环境变量**:
```bash
RESEND_API_KEY="re_xxxxx"
RESEND_AUDIENCE_ID="xxxxx"
```

**免费额度**: 3000封邮件/月

### 4. GitHub OAuth 配置 (可选)

1. **创建OAuth应用**: https://github.com/settings/applications/new
2. **配置信息**:
   - Application name: Dreisatz Rechner
   - Homepage URL: https://dreisatzrechner.org
   - Authorization callback URL: https://dreisatzrechner.org/api/auth/callback/github
3. **获取密钥**:
```bash
GITHUB_CLIENT_ID="xxxxx"
GITHUB_CLIENT_SECRET="xxxxx"
```

### 5. 可选增强配置

#### Turnstile 验证码 (防滥用)
- 访问: https://www.cloudflare.com/products/turnstile/
- 免费，无限验证
- 配置: `NEXT_PUBLIC_TURNSTILE_SITE_KEY`, `TURNSTILE_SECRET_KEY`

#### 通知服务
**Discord Webhook**:
- 创建Discord服务器
- 设置Webhook URL
- 配置: `DISCORD_WEBHOOK_URL`

## 🔧 配置优先级

### 第一优先级 (立即配置)
1. ✅ Google AI Studio API密钥
2. ✅ DeepSeek API密钥  
3. ✅ Replicate API令牌
4. ✅ Stripe积分包价格ID

### 第二优先级 (一周内配置)
1. ✅ Resend邮件服务
2. ✅ Fal.ai API密钥
3. ✅ GitHub OAuth

### 第三优先级 (可选)
1. ✅ Fireworks AI
2. ✅ OpenRouter
3. ✅ Turnstile验证码

## ⚡ 快速测试步骤

### 配置完成后测试:

1. **重启开发服务器**:
```bash
pnpm dev
```

2. **测试功能模块**:
   - ✅ 用户注册/登录
   - ✅ AI图像生成 (测试不同提供商)
   - ✅ 支付流程 (Stripe测试模式)
   - ✅ 邮件发送 (注册验证邮件)

3. **监控错误**:
   - 查看浏览器控制台
   - 检查服务器日志
   - 验证API调用成功

## 🛡️ 安全提醒

1. **不要提交敏感信息**: 确保 `.env` 在 `.gitignore` 中
2. **生产环境密钥**: 使用 Vercel 环境变量管理
3. **API密钥权限**: 设置最小必要权限
4. **监控使用量**: 定期检查各服务的使用量和费用

## 📊 预期成本 (月度)

- **AI服务**: $20-50 (根据使用量)
- **邮件服务**: 免费 (3000封以内)
- **存储服务**: $1-5 (已配置R2)
- **Stripe费用**: 2.9% + $0.30/笔交易

## 🆘 问题排查

**AI图像生成失败**:
- 检查API密钥是否正确
- 确认服务商账户余额
- 查看错误日志

**邮件发送失败**:
- 验证域名DNS设置
- 检查Resend API密钥
- 确认发送限制

**支付问题**:
- 验证Stripe价格ID
- 检查Webhook配置
- 确认测试/生产模式

---

*配置完成后，你的AI Polaroid Photo项目将具备完整的商业功能！*
